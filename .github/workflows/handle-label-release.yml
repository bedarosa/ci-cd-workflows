name: (Internal) Handle PR Labels based in a commit
run-name:  (Internal) Handle PR Labels based in a commit

on:
  workflow_call:
    outputs:
      ORBITDOTNET_FOUND:
        value: ${{ jobs.get_labels_release.outputs.ORBITDOTNET_FOUND }}
      ORBITDOTNET_RESULTS_FOUND:
        value: ${{ jobs.get_labels_release.outputs.ORBITDOTNET_RESULTS_FOUND }}
        
jobs:
  get_labels_release:
    runs-on: ubuntu-latest
    outputs:
      ORBITDOTNET_FOUND: ${{ steps.get_labels_release.outputs.ORBITDOTNET_FOUND }}
      ORBITDOTNET_RESULTS_FOUND: ${{ steps.get_labels_release.outputs.ORBITDOTNET_RESULTS_FOUND }}
    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: Install GitHub CLI
        run: sudo apt-get install -y gh

      - name: Authenticate GitHub CLI
        run: |
          echo ${{ secrets.GITHUB_TOKEN }} | gh auth login --with-token
        
      - name: Get the latest commit SHA
        id: get_labels_release
        run: |
          echo "COMMIT_SHA=$(git rev-parse HEAD)" >> $GITHUB_ENV
          pr=$(gh pr list --search "${{ env.COMMIT_SHA }}" --json number --jq '.[0].number')
          echo "$pr"
 
          if [ -z "$pr" ]; then
            echo "No PR found for commit ${{ env.COMMIT_SHA }}"
          else
            echo "PR Number: $pr"
            pr_view=$(gh pr view $pr --json labels)

            if echo "$pr_view" | grep -q "OrbitDotnet"; then
              echo "The label 'OrbitDotnet' was found."
              echo "ORBITDOTNET_FOUND=true" >> $GITHUB_OUTPUT
            else
              echo "The label 'orbitdotnet' was not found."
              echo "ORBITDOTNET_FOUND=false" >> $GITHUB_OUTPUT
            fi

            if echo "$pr_view" | grep -q "OrbitDotnet.Results"; then
              echo "The label 'OrbitDotnet.Results' was found."
              echo "ORBITDOTNET_RESULTS_FOUND=true" >> $GITHUB_OUTPUT
            else
              echo "The label 'OrbitDotnet.Results' was not found."
              echo "ORBITDOTNET_RESULTS_FOUND=false" >> $GITHUB_OUTPUT
            fi
          fi

      